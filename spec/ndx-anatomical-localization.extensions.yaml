groups:
  - neurodata_type_def: Localization
    neurodata_type_inc: LabMetaData
    name: localization
    doc: "A class for storing anatomical localization information"
    groups:
      - neurodata_type_inc: AnatomicalCoordinatesTable
        quantity: "*"
        doc: "A table for storing localization in a space"
      - neurodata_type_inc: Space
        quantity: "*"
        doc: "A space in which the coordinates are defined"
      - neurodata_type_inc: AnatomicalCoordinatesImage
        quantity: "*"
        doc: "An container for storing localization of a field of view in a space"
  - neurodata_type_def: Space
    neurodata_type_inc: NWBContainer
    doc: "a space"
    attributes:
      - name: "space_name"
        doc: "name of the space"
        dtype: text
        required: true
      - name: origin
        doc: "A description of where (0,0,0) is in the space. For example, 'bregma' is a common origin for mice."
        dtype: text
        required: true
      - name: units
        doc: "The units of measurement for the x,y,z coordinates. For example, 'mm' for millimeters."
        dtype: text
        required: true
      - name: orientation
        doc:
          "A 3-letter string indicating the positive direction along each axis, where the 1st letter
          is for x, 2nd for y, and 3rd for z. Each letter can be: A (Anterior), P (Posterior), L (Left),
          R (Right), S (Superior/Dorsal), or I (Inferior/Ventral). The three letters must cover all three
          anatomical dimensions (one from A/P, one from L/R, one from S/I). For example, 'RAS' means
          positive x is Right, positive y is Anterior, positive z is Superior. Notes: (1) These three
          dimensions are also commonly referred to as AP, ML, and DV. (2) This convention specifies
          positive directions (sometimes written as 'RAS+'), not origin location - use the 'origin' field
          to describe where (0,0,0) is located."
        dtype: text
        required: true
    datasets:
      - name: extent
        doc:
          "The spatial extent (bounding box dimensions) of the coordinate space as [x, y, z].
          For corner-origin spaces like Allen CCF, this specifies the atlas dimensions.
          Units match the 'units' attribute. Optional - may be None for landmark-centered atlases."
        dtype: float64
        dims:
          - num_dimensions
        shape:
          - 3
        quantity: "?"
  - neurodata_type_def: AllenCCFv3Space
    neurodata_type_inc: Space
    doc:
      "The Allen Mouse Brain Common Coordinate Framework version 3 (2020). This canonical space uses PIR orientation
      (positive x=Posterior, positive y=Inferior, positive z=Right) with 10 micrometer resolution.
      The origin (0,0,0) is at the anterior-superior-left corner of the 3D image volume."
    attributes:
      - name: space_name
        dtype: text
        value: AllenCCFv3
        doc: "Name of the space (fixed to AllenCCFv3)"
      - name: origin
        dtype: text
        value: Anterior-Superior-Left (ASL) corner of the 3D image volume
        doc: "Origin of the coordinate system (fixed)"
      - name: units
        dtype: text
        value: um
        doc: "Units of measurement (fixed to micrometers)"
      - name: orientation
        dtype: text
        value: PIR
        doc: "Orientation of the coordinate system (fixed to PIR, indicating positive axis directions)"
    datasets:
      - name: extent
        dtype: float64
        dims:
          - num_dimensions
        shape:
          - 3
        value: [13200.0, 8000.0, 11400.0]
        doc: "Atlas extent in micrometers: [AP=13200, DV=8000, ML=11400]"
  - neurodata_type_def: AnatomicalCoordinatesTable
    neurodata_type_inc: DynamicTable
    doc: "A table for storing anatomical coordinates for rows of another table determined using a single method"
    links:
      - target_type: Space
        quantity: 1
        doc: "The space in which the coordinates are defined"
        name: space
    attributes:
      - name: method
        doc: "The method used to determine the coordinates"
        dtype: text
        required: true
    datasets:
      - name: x
        neurodata_type_inc: VectorData
        doc: "The x coordinate"
        quantity: 1
      - name: "y"
        neurodata_type_inc: VectorData
        doc: "The y coordinate"
        quantity: 1
      - name: z
        neurodata_type_inc: VectorData
        doc: "The z coordinate"
        quantity: 1
      - name: localized_entity
        neurodata_type_inc: DynamicTableRegion
        doc: "A reference to the object being localized (e.g. electrode)"
        quantity: 1
      - name: brain_region
        neurodata_type_inc: VectorData
        doc: "The brain region associated with the localization"
        dtype: text
        quantity: "?"

  - neurodata_type_def: AnatomicalCoordinatesImage
    neurodata_type_inc: NWBContainer
    doc: "Image with Coordinates per Pixel. Each pixel stores its coordinates (x, y, z). Thus, x[i, j], y[i, j], z[i, j] give the atlas location for pixel (i, j)"
    links:
      - target_type: Space
        quantity: 1
        doc: "The space in which the coordinates are defined"
        name: space
      - target_type: Image
        quantity: "?"
        doc: "The image associated with the coordinates"
        name: image
      - target_type: ImagingPlane
        quantity: "?"
        doc: "The imaging plane associated with the coordinates"
        name: imaging_plane
    attributes:
      - name: method
        doc: "The method used to determine the coordinates"
        dtype: text
        required: true
      - name: description
        doc: "A description of the anatomical coordinates image"
        dtype: text
        required: false
    datasets:
      - name: x
        dtype: float32
        dims:
          - - width
            - height
        shape:
          - - null
            - null
        doc: 2D array containing X coordinates for each pixel (width x height) #TODO update to (height x width) once NWB schema is updated
        quantity: 1
      - name: y
        dtype: float32
        dims:
          - - width
            - height
        shape:
          - - null
            - null
        doc: 2D array containing Y coordinates for each pixel (width x height) #TODO update to (height x width) once NWB schema is updated
        quantity: 1
      - name: z
        dtype: float32
        dims:
          - - width
            - height
        shape:
          - - null
            - null
        doc: 2D array containing Z coordinates for each pixel (width x height) #TODO update to (height x width) once NWB schema is updated
        quantity: 1

      - name: brain_region
        dtype: text
        dims:
          - - width
            - height
        shape:
          - - null
            - null
        doc: 2D array of brain region names for each pixel
        quantity: "?"

      - name: brain_region_id
        dtype: int32
        dims:
          - - width
            - height
        shape:
          - - null
            - null
        doc: 2D array of brain region IDs for each pixel (corresponding to atlas ontology)
        quantity: "?"
